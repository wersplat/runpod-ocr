version: "3.9"

services:
  labelstudio:
    image: heartexlabs/label-studio:latest
    container_name: labelstudio
    restart: unless-stopped
    runtime: nvidia
    environment:
      LABEL_STUDIO_HOST: "0.0.0.0"
      LABEL_STUDIO_DEFAULT_USERNAME: "${LABEL_STUDIO_DEFAULT_USERNAME}"
      LABEL_STUDIO_DEFAULT_PASSWORD: "${LABEL_STUDIO_DEFAULT_PASSWORD}"
      LABEL_STUDIO_LOCAL_FILES_SERVING_ENABLED: "true"
      LABEL_STUDIO_LOCAL_FILES_DOCUMENT_ROOT: "/data"
      DJANGO_DB: "sqlite"
    ports:
      - "${LABEL_PORT}:8080"
    volumes:
      - ./data:/data
      - ./logs/labelstudio:/label-studio/log
    command: >
      /bin/bash -lc "
      label-studio start --host 0.0.0.0 --port 8080
      "

  ocr-api:
    build:
      context: ./ocr-api
      dockerfile: Dockerfile
    container_name: ocr-api
    restart: unless-stopped
    runtime: nvidia
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    environment:
      DEEPSEEK_OCR_BASE_SIZE: "${DEEPSEEK_OCR_BASE_SIZE:-1024}"
      DEEPSEEK_OCR_IMAGE_SIZE: "${DEEPSEEK_OCR_IMAGE_SIZE:-640}"
      DEEPSEEK_OCR_CROP_MODE: "${DEEPSEEK_OCR_CROP_MODE:-true}"
      CUDA_VISIBLE_DEVICES: "${CUDA_VISIBLE_DEVICES:-0}"
    ports:
      - "${OCR_PORT:-8000}:8000"
    volumes:
      - ./models:/models
      - ./data:/data
      - ./logs/ocr:/app/logs

networks:
  default:
<<<<<<< HEAD
    name: label-ocr-net
=======
    name: ocr-net
>>>>>>> 12778a8 (Refactor OCR API: Updated to use DeepSeek-OCR model, added new endpoints for OCR and markdown conversion, and improved Dockerfile for Python 3.12 support.)
